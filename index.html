<!Doctype HTML>
<html>

<head>
	<title> 3300 P1</title>
	<meta charset="UTF-8">
	<style>
  svg { background-color: #f5f5dc; }
  </style>
	<script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>
	<p> Visualize Data Here </p>
	<div id="container">
		<svg height="1000" width="1000" id="svg"></svg>
	</div>
	<script>

		// snag the svg element from outside the script tag
		var svg = d3.select("#svg");

		// get the height/width of the svg element as variables
		var width = document.getElementsByTagName("svg")[0].getAttribute("width");
		var height = document.getElementsByTagName("svg")[0].getAttribute("height");

		// json obj to hold all of the read-in files
		var totalMedals = new Object();

		// read in the summerMedalData csv file
		d3.csv("summerMedalData.csv", function(data) {
			data.forEach(function(d) {
				totalMedals[d.country] = {
					count: Number(d["count(*)"])
				};
			});
		});

		// read in the winterMedalData csv file and add to summer
		d3.csv("winterMedalData.csv", function(data) {
			data.forEach(function(d) {
				if (totalMedals[d.country] != undefined) {
					totalMedals[d.country].count += Number(d["count(*)"])
				}
			});

			console.log(totalMedals);

			// here, subarr is an intermediary array to hold medal counts, which will be then be sorted
			subarr = []
			for (key in totalMedals) {
				subarr.push(totalMedals[key].count)
			}

			// sort the medal counts and then extract top 10
			subarr.sort(function(a,b) {
				return b - a
			});

			// top ten medal counts with their respective country
			var tenCounts = subarr.slice(0, 10)
			var tenCountries = []

			tenCounts.forEach(function(x) {
				for (key in totalMedals) {
					if(totalMedals[key].count == x) {
						tenCountries.push(key)
					}
				}
			})

			console.log(tenCounts);
			console.log(tenCountries);

			// height of each bar scale
			var pedScale = d3.scaleLinear()
      .domain([tenCounts[9], tenCounts[0]])
      .range([100, 400]);

			// x-dist of top three
			var topThreeScale = d3.scaleLinear()
			.domain([1, 3])
			.range([width/4, width/4 + 250])

			// x-dist of bottom seven
			var bottomSevenScale = d3.scaleLinear()
			.domain([4,10])
			.range([width/4, width/4 + 320])

			var top = height - (height-300)

			// Title
			svg.append("text")
			.attr("x", 120)
			.attr("y", height - (height-50))
			.attr("font-family", "Georgia")
			.attr("font-size", 40)
			.attr("fill", "grey")
			.text("Highest Medal-Earning Countries")
			svg.append("text")
			.attr("x", 90)
			.attr("y", height - (height-90))
			.attr("font-family", "Georgia")
			.attr("font-size", 40)
			.attr("fill", "grey")
			.text("Across Winter and Summer Olympics")
			svg.append("text")
			.attr("x", 300)
			.attr("y", height - (height-130))
			.attr("font-family", "Georgia")
			.attr("font-size", 40)
			.attr("fill", "grey")
			.text("(1985 - 2012)")

			// Logo
			svg.append("image")
			.attr("xlink:href", "olympic-logo.png")
			.attr("x", topThreeScale(1) - 320)
			.attr("y", top)
			.attr("height", 500)
			.attr("width", 1000)
			.attr("opacity", "0.35");

			// 1st place
			svg.append("rect")
			.attr("x", topThreeScale(2))
			.attr("y", top)
			.attr("height", pedScale(tenCounts[0]))
			.attr("width", 120)
			.style("fill", "#FFD700");
			svg.append("image")
			.attr("xlink:href", "flag1.png")
			.attr("x", topThreeScale(2) + 10)
			.attr("y", top-100)
			.attr("width", 100)
			.attr("height", 80);
			svg.append("text")
			.attr("x", topThreeScale(2) + 25)
			.attr("y", top + 45)
			.attr("font-family", "Arial")
			.attr("font-size", 40)
			.attr("fill", "white")
			.text(tenCounts[0]);

			// 2nd place
			svg.append("rect")
			.attr("y", top + (pedScale(tenCounts[0]) - pedScale(tenCounts[1])))
			.attr("x", topThreeScale(1))
			.attr("height", pedScale(tenCounts[1]))
			.attr("width", 120)
			.style("fill", "#8B8878");
			svg.append("image")
			.attr("xlink:href", "flag2.png")
			.attr("x", topThreeScale(1) + 10)
			.attr("y", top + (pedScale(tenCounts[0]) - pedScale(tenCounts[1])) - 100)
			.attr("width", 100)
			.attr("height", 80);
			svg.append("text")
			.attr("x", topThreeScale(1) + 25)
			.attr("y", top + (pedScale(tenCounts[0]) - pedScale(tenCounts[1])) + 45)
			.attr("font-family", "Arial")
			.attr("font-size", 40)
			.attr("fill", "white")
			.text(tenCounts[1]);

			// 3rd place
			svg.append("rect")
			.attr("y", top + (pedScale(tenCounts[0]) - pedScale(tenCounts[2])))
			.attr("x", topThreeScale(3))
			.attr("height", pedScale(tenCounts[2]))
			.attr("width", 120)
			.style("fill", "#A67D3D");
			svg.append("image")
			.attr("xlink:href", "flag3.png")
			.attr("x", topThreeScale(3) + 10)
			.attr("y", top + (pedScale(tenCounts[0]) - pedScale(tenCounts[2])) - 100)
			.attr("width", 100)
			.attr("height", 80);
			svg.append("text")
			.attr("x", topThreeScale(3) + 25)
			.attr("y", top + (pedScale(tenCounts[0]) - pedScale(tenCounts[2])) + 40)
			.attr("font-family", "Arial")
			.attr("font-size", 40)
			.attr("fill", "white")
			.text(tenCounts[2]);

			var bottomTop = top+pedScale(tenCounts[0])+5

			// 4th place
			svg.append("rect")
			.attr("y", bottomTop)
			.attr("x", bottomSevenScale(4))
			.attr("height", pedScale(tenCounts[3]))
			.attr("width", 49)
			.style("fill", "#8C7853");
			svg.append("image")
			.attr("xlink:href", "flag4.png")
			.attr("x", bottomSevenScale(4) + 5)
			.attr("y", bottomTop + pedScale(tenCounts[3]) + 10)
			.attr("width", 40)
			.attr("height", 30);
			svg.append("text")
			.attr("x", bottomSevenScale(4) + 8)
			.attr("y", bottomTop + pedScale(tenCounts[3]) - 10)
			.attr("font-family", "Arial")
			.attr("font-size", 18)
			.attr("fill", "white")
			.text(tenCounts[3]);

			// // 5th place
			svg.append("rect")
			.attr("y", bottomTop)
			.attr("x", bottomSevenScale(5))
			.attr("height", pedScale(tenCounts[4]))
			.attr("width", 49)
			.style("fill", "#8C7853");
			svg.append("image")
			.attr("xlink:href", "flag5.png")
			.attr("x", bottomSevenScale(5) + 5)
			.attr("y", bottomTop + pedScale(tenCounts[4]) + 10)
			.attr("width", 40)
			.attr("height", 30);
			svg.append("text")
			.attr("x", bottomSevenScale(5) + 9)
			.attr("y", bottomTop + pedScale(tenCounts[4]) - 10)
			.attr("font-family", "Arial")
			.attr("font-size", 18)
			.attr("fill", "white")
			.text(tenCounts[4]);
			//
			// // 6th place
			svg.append("rect")
			.attr("y", bottomTop)
			.attr("x", bottomSevenScale(6))
			.attr("height", pedScale(tenCounts[5]))
			.attr("width", 49)
			.style("fill", "#8C7853");
			svg.append("image")
			.attr("xlink:href", "flag6.png")
			.attr("x", bottomSevenScale(6) + 5)
			.attr("y", bottomTop + pedScale(tenCounts[5]) + 10)
			.attr("width", 40)
			.attr("height", 30);
			svg.append("text")
			.attr("x", bottomSevenScale(6) + 10)
			.attr("y", bottomTop +  pedScale(tenCounts[5]) - 10)
			.attr("font-family", "Arial")
			.attr("font-size", 18)
			.attr("fill", "white")
			.text(tenCounts[5]);

			// // 7th place
			svg.append("rect")
			.attr("y", bottomTop)
			.attr("x", bottomSevenScale(7))
			.attr("height", pedScale(tenCounts[6]))
			.attr("width", 49)
			.style("fill", "#8C7853");
			svg.append("image")
			.attr("xlink:href", "flag7.jpg")
			.attr("x", bottomSevenScale(7) + 5)
			.attr("y", bottomTop + pedScale(tenCounts[6]) + 10)
			.attr("width", 40)
			.attr("height", 30);
			svg.append("text")
			.attr("x", bottomSevenScale(7) + 9)
			.attr("y", bottomTop + pedScale(tenCounts[6]) - 10)
			.attr("font-family", "Arial")
			.attr("font-size", 18)
			.attr("fill", "white")
			.text(tenCounts[6]);
			//
			// // 8th place
			svg.append("rect")
			.attr("y", bottomTop)
			.attr("x", bottomSevenScale(8))
			.attr("height", pedScale(tenCounts[7]))
			.attr("width", 49)
			.style("fill", "#8C7853");
			svg.append("image")
			.attr("xlink:href", "flag8.png")
			.attr("x", bottomSevenScale(8) + 5)
			.attr("y", bottomTop + pedScale(tenCounts[7]) + 10)
			.attr("width", 40)
			.attr("height", 30);
			svg.append("text")
			.attr("x", bottomSevenScale(8) + 9)
			.attr("y", bottomTop + pedScale(tenCounts[7]) - 10)
			.attr("font-family", "Arial")
			.attr("font-size", 18)
			.attr("fill", "white")
			.text(tenCounts[7]);
			//
			// // 9th place
			svg.append("rect")
			.attr("y", bottomTop)
			.attr("x", bottomSevenScale(9))
			.attr("height", pedScale(tenCounts[8]))
			.attr("width", 49)
			.style("fill", "8C7853");
			svg.append("image")
			.attr("xlink:href", "flag9.png")
			.attr("x", bottomSevenScale(9) + 5)
			.attr("y", bottomTop + pedScale(tenCounts[8]) + 10)
			.attr("width", 40)
			.attr("height", 30);
			svg.append("text")
			.attr("x", bottomSevenScale(9) + 9)
			.attr("y", bottomTop + pedScale(tenCounts[8]) - 10)
			.attr("font-family", "Arial")
			.attr("font-size", 18)
			.attr("fill", "white")
			.text(tenCounts[8]);

			// // 10th place
			svg.append("rect")
			.attr("y", bottomTop)
			.attr("x", bottomSevenScale(10))
			.attr("height", pedScale(tenCounts[9]))
			.attr("width", 49)
			.style("fill", "#8C7853");
			svg.append("image")
			.attr("xlink:href", "flag10.png")
			.attr("x", bottomSevenScale(10) + 5)
			.attr("y", bottomTop + pedScale(tenCounts[9]) + 10)
			.attr("width", 40)
			.attr("height", 30);
			svg.append("text")
			.attr("x", bottomSevenScale(10) + 9)
			.attr("y", bottomTop + pedScale(tenCounts[9]) - 10)
			.attr("font-family", "Arial")
			.attr("font-size", 18)
			.attr("fill", "white")
			.text(tenCounts[9]);

		}); // end of callback

	</script>
</body>



</html>
