<!Doctype HTML>
<html>

<head>
	<title> 3300 P1</title>
	<meta charset="UTF-8">
	<style>
  svg { background-color: #f5f5dc; display:block; margin:auto; }
  .title {text-align:center; font-size:24px; color:white;}
  </style>
	<script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<!-- Background Image Courtesy of : https://www.elegantthemes.com/blog/freebie-of-the-week/20-free-background-images-for-wordpress -->
<body background="img/background-blue-circles.jpg">
	<p class="title"> What Makes A Country Great? </p>
	<div id="container">
		<svg height="800" width="700" id="svg"></svg>
	</div>
	<script id="PodiumVisualization">

		// snag the svg element from outside the script tag
		var svg = d3.select("#svg");

		// get the height/width of the svg element as variables
		var width = document.getElementsByTagName("svg")[0].getAttribute("width");
		var height = document.getElementsByTagName("svg")[0].getAttribute("height");

		// json obj to hold all of the read-in files
		var totalMedals = new Object();

		// read in the summerMedalData csv file
		d3.csv("summerMedalData.csv", function(data) {
			data.forEach(function(d) {
				totalMedals[d.country] = {
					count: Number(d["count(*)"])
				};
			});
		});

		// read in the winterMedalData csv file and add to summer
		d3.csv("winterMedalData.csv", function(data) {
			data.forEach(function(d) {
				if (totalMedals[d.country] != undefined) {
					totalMedals[d.country].count += Number(d["count(*)"])
				}
			});

			console.log(totalMedals);

			// here, subarr is an intermediary array to hold medal counts, which will be then be sorted
			subarr = []
			for (key in totalMedals) {
				subarr.push(totalMedals[key].count)
			}

			// sort the medal counts and then extract top 10
			subarr.sort(function(a,b) {
				return b - a
			});

			// top ten medal counts with their respective country
			var tenCounts = subarr.slice(0, 10)
			var tenCountries = []

			tenCounts.forEach(function(x) {
				for (key in totalMedals) {
					if(totalMedals[key].count == x) {
						tenCountries.push(key)
					}
				}
			})

			console.log(tenCounts);
			console.log(tenCountries);

			var pedScale = d3.scaleLinear()
      .domain([tenCounts[9], tenCounts[0]])
      .range([100, 400]);

			console.log(pedScale(tenCounts[0]))

			// 1st, place
			svg.append("rect")
			.attr("y", 150)
			.attr("x", width/2 - 98/2)
			.attr("height", pedScale(tenCounts[0]))
			.attr("width", 98)
			.style("fill", "#FFD700");
			svg.append("image")
			.attr("xlink:href", "img/flag1.png")
			.attr("x", width/2 - 74/2)
			.attr("y", height/2 - 320)
			.attr("width", 74);
			svg.append("text")
			.attr("x", width/2 - 20)
			.attr("y", height/2 - 200)
			.attr("font-family", "Arial")
			.attr("font-size", 25)
			.attr("fill", "#F09F12")
			.text(tenCounts[0]);

			// 2nd place
			svg.append("rect")
			.attr("y", 150 + (400 - pedScale(tenCounts[1])))
			.attr("x", width/2 + 50)
			.attr("height", pedScale(tenCounts[1]))
			.attr("width", 98)
			.style("fill", "#FFD700");
			svg.append("image")
			.attr("xlink:href", "img/flag2.png")
			.attr("x", width/2 + 62)
			.attr("y", height/2 - 180)
			.attr("width", 74);
			svg.append("text")
			.attr("x", width/2 + 79)
			.attr("y", height/2 - 52)
			.attr("font-family", "Arial")
			.attr("font-size", 25)
			.attr("fill", "#F09F12")
			.text(tenCounts[1]);

			// 3rd place
			svg.append("rect")
			.attr("y", 150 + (400 - pedScale(tenCounts[2])))
			.attr("x", width/2 - 98*1.5 - 1)
			.attr("height", pedScale(tenCounts[2]))
			.attr("width", 98)
			.style("fill", "#FFD700");
			svg.append("image")
			.attr("xlink:href", "img/flag3.png")
			.attr("x", width/2 - 98*1.5 + 9)
			.attr("y", height/2 - 175)
			.attr("width", 74);
			svg.append("text")
			.attr("x", width/2 - 98*1.5 + 25)
			.attr("y", height/2 - 45)
			.attr("font-family", "Arial")
			.attr("font-size", 25)
			.attr("fill", "#F09F12")
			.text(tenCounts[2]);

			// 4th place
			svg.append("rect")
			.attr("y", 550 + 1)
			.attr("x", width/2 - 98*1.5 - 1)
			.attr("height", pedScale(tenCounts[3]))
			.attr("width", 290/7)
			.style("fill", "#FFD700");
			svg.append("image")
			.attr("xlink:href", "img/flag4.png")
			.attr("x", width/2 - 98*1.5 + 4)
			.attr("y", height/2 + 370)
			.attr("width", 290/7 - 10);
			svg.append("text")
			.attr("x", width/2 - 98*1.5 + 6)
			.attr("y", height/2 + 350)
			.attr("font-family", "Arial")
			.attr("font-size", 15)
			.attr("fill", "#F09F12")
			.text(tenCounts[3]);

			// 5th place
			svg.append("rect")
			.attr("y", 550 + 1)
			.attr("x", width/2 - 147 + 290/7)
			.attr("height", pedScale(tenCounts[4]))
			.attr("width", 290/7)
			.style("fill", "#FFD700");
			svg.append("image")
			.attr("xlink:href", "img/flag5.png")
			.attr("x", width/2 - 147 + 290/7 + 5)
			.attr("y", height/2 + 300)
			.attr("width", 290/7 - 10);
			svg.append("text")
			.attr("x", width/2 - 147 + 290/7 + 8)
			.attr("y", height/2 + 280)
			.attr("font-family", "Arial")
			.attr("font-size", 15)
			.attr("fill", "#F09F12")
			.text(tenCounts[4]);

			// 5th place
			svg.append("rect")
			.attr("y", 550 + 1)
			.attr("x", width/2 - 146 + (290/7)*2)
			.attr("height", pedScale(tenCounts[5]))
			.attr("width", 290/7)
			.style("fill", "#FFD700");
			svg.append("image")
			.attr("xlink:href", "img/flag6.png")
			.attr("x", width/2 - 146 + (290/7)*2 + 5)
			.attr("y", height/2 + 288)
			.attr("width", 290/7 - 10);
			svg.append("text")
			.attr("x", width/2 - 146 + (290/7)*2 + 9)
			.attr("y", height/2 + 267)
			.attr("font-family", "Arial")
			.attr("font-size", 15)
			.attr("fill", "#F09F12")
			.text(tenCounts[5]);

			// 6th place
			svg.append("rect")
			.attr("y", 550 + 1)
			.attr("x", width/2 - 145 + (290/7)*3)
			.attr("height", pedScale(tenCounts[6]))
			.attr("width", 290/7)
			.style("fill", "#FFD700");
			svg.append("image")
			.attr("xlink:href", "img/flag7.jpg")
			.attr("x", width/2 - 146 + (290/7)*3 + 7)
			.attr("y", height/2 + 285)
			.attr("width", 290/7 - 10);
			svg.append("text")
			.attr("x", width/2 - 146 + (290/7)*3 + 10)
			.attr("y", height/2 + 265)
			.attr("font-family", "Arial")
			.attr("font-size", 15)
			.attr("fill", "#F09F12")
			.text(tenCounts[6]);

			// 7th place
			svg.append("rect")
			.attr("y", 550 + 1)
			.attr("x", width/2 - 144 + (290/7)*4)
			.attr("height", pedScale(tenCounts[7]))
			.attr("width", 290/7)
			.style("fill", "#FFD700");
			svg.append("image")
			.attr("xlink:href", "img/flag8.png")
			.attr("x", width/2 - 146 + (290/7)*4 + 7)
			.attr("y", height/2 + 267)
			.attr("width", 290/7 - 10);
			svg.append("text")
			.attr("x", width/2 - 146 + (290/7)*4 + 11)
			.attr("y", height/2 + 248)
			.attr("font-family", "Arial")
			.attr("font-size", 15)
			.attr("fill", "#F09F12")
			.text(tenCounts[7]);

			// 8th place
			svg.append("rect")
			.attr("y", 550 + 1)
			.attr("x", width/2 - 143 + (290/7)*5)
			.attr("height", pedScale(tenCounts[8]))
			.attr("width", 290/7)
			.style("fill", "#FFD700");
			svg.append("image")
			.attr("xlink:href", "img/flag9.png")
			.attr("x", width/2 - 146 + (290/7)*5 + 8)
			.attr("y", height/2 + 265)
			.attr("width", 290/7 - 10);
			svg.append("text")
			.attr("x", width/2 - 146 + (290/7)*5 + 12)
			.attr("y", height/2 + 246)
			.attr("font-family", "Arial")
			.attr("font-size", 15)
			.attr("fill", "#F09F12")
			.text(tenCounts[8]);

			// 9th place
			svg.append("rect")
			.attr("y", 550 + 1)
			.attr("x", width/2 - 142 + (290/7)*6)
			.attr("height", pedScale(tenCounts[9]))
			.attr("width", 290/7)
			.style("fill", "#FFD700");
			svg.append("image")
			.attr("xlink:href", "img/flag10.png")
			.attr("x", width/2 - 146 + (290/7)*6 + 9)
			.attr("y", height/2 + 262)
			.attr("width", 290/7 - 10);
			svg.append("text")
			.attr("x", width/2 - 146 + (290/7)*6 + 13)
			.attr("y", height/2 + 244)
			.attr("font-family", "Arial")
			.attr("font-size", 15)
			.attr("fill", "#F09F12")
			.text(tenCounts[9]);

		}); // end of callback

	</script>

    <script id="GDPvMedals">

        d3.select("body").append("br");
        var svgS = d3.select("body").append("svg")
        .attr("height", 400)
        .attr("width", 600)
        .style("background-color", "#ff6600");

        d3.select("body").append("br");
        var svgW = d3.select("body").append("svg")
        .attr("height", 400)
        .attr("width", 600)
        .style("background-color", "#3366ff");

        d3.queue()
        .defer(d3.csv, "winterGDPMedalData.csv")
        .defer(d3.csv, "summerGDPMedalData.csv")
        .await(showGraph);

        function showGraph(error, wData, sData) {

            wData.sort(function(a, b){ return b.Medals - a.Medals});
            sData.sort(function(a, b){ return b.Medals - a.Medals});

            console.log("winter:" + wData.slice(0,10).map(function (d) {return d.Country}));
            console.log("summer:" + sData.slice(0,10).map(function (d) {return d.Country}));
            console.log(wData[0].Country);
            console.log(sData[0].Country);
            var xMax = d3.max(
                [
                d3.max(wData, function (d) {
                    return +d.GDP_per_Capita;
                }),
                d3.max(sData, function (d) {
                    return +d.GDP_per_Capita;
                })
                ]);

            svgS.append("text")
            .attr("x", 300)
            .attr("y", 50)
            .style("text-anchor", "middle")
            .text("Summer Medals Earned vs. GDP");
            var yMaxS = d3.max(sData, function (d) {return +d.Medals});

            var xScale = d3.scaleLinear()
            .domain([0,xMax])
            .range([100,500]);

            var yScaleS = d3.scaleLinear()
            .domain([0, yMaxS])
            .range([300,100]);

            var xAxis = d3.axisBottom(xScale);
            var yAxis = d3.axisLeft(yScaleS);

            svgS.append("g").call(xAxis).attr("transform","translate(0,300)");
            svgS.append("g").call(yAxis).attr("transform","translate(100,0)");

            sData.forEach(function (d, i) {
                if(i<10) { //Top 10 Medal earning countries
                    if (d.Country == "China") {
                        svgS.append("line")
                        .attr("x1", xScale(+d.GDP_per_Capita) + 20)
                        .attr("x2", xScale(+d.GDP_per_Capita) + 30)
                        .attr("y1", yScaleS(+d.Medals))
                        .attr("y2", yScaleS(+d.Medals) - 3)
                        .style("stroke", "black")
                        .style("stroke-width", "1");

                        svgS.append("image")
                        .attr("x", xScale(+d.GDP_per_Capita))
                        .attr("y", yScaleS(+d.Medals))
                        .attr("xlink:href", "img/ByName/" + d.Country + ".png")
                        .attr("width", 20);

                        svgS.append("text")
                        .text("China")
                        .attr("x", xScale(+d.GDP_per_Capita) + 30)
                        .attr("y", yScaleS(+d.Medals) - 3)
                        .style("fill", "black")
                        .style("font-size", "8px");
                    }
                    else {
                    svgS.append("image")
                        .attr("x", xScale(+d.GDP_per_Capita))
                        .attr("y", yScaleS(+d.Medals))
                        .attr("xlink:href", "img/ByName/" + d.Country + ".png")
                        .attr("width", 20);
                    }
                }
                else {
                    svgS.append("circle")
                    .attr("r", 2)
                    .attr("cx", xScale(+d.GDP_per_Capita))
                    .attr("cy", yScaleS(+d.Medals))
                    .style("fill","black");
                }
            });

            svgW.append("text")
            .attr("x", 300)
            .attr("y", 50)
            .style("text-anchor", "middle")
            .text("Winter Medals Earned vs. GDP");
            var yMaxW = d3.max(wData, function (d) {return +d.Medals});


            var yScaleW = d3.scaleLinear()
            .domain([0, yMaxW])
            .range([300,100]);

            var yAxisW = d3.axisLeft(yScaleW);


            svgW.append("g").call(xAxis).attr("transform","translate(0,300)");
            svgW.append("g").call(yAxisW).attr("transform","translate(100,0)");

            wData.forEach(function (d, i) {
                if(i<10) { //Top 10 Medal earning countries
                    // Overlapped by Canada...
                    if (d.Country == "Austria") {

                        svgW.append("line")
                        .attr("x1", xScale(+d.GDP_per_Capita) + 20)
                        .attr("x2", xScale(+d.GDP_per_Capita) + 30)
                        .attr("y1", yScaleW(+d.Medals))
                        .attr("y2", yScaleW(+d.Medals) - 3)
                        .style("stroke", "black")
                        .style("stroke-width", "1");

                        svgW.append("image")
                        .attr("x", xScale(+d.GDP_per_Capita))
                        .attr("y", yScaleW(+d.Medals))
                        .attr("xlink:href", "img/ByName/" + d.Country + ".png")
                        .attr("width", 20);

                        svgW.append("text")
                        .text("Austria")
                        .attr("x", xScale(+d.GDP_per_Capita) + 30)
                        .attr("y", yScaleW(+d.Medals) - 3)
                        .style("fill", "black")
                        .style("font-size", "8px");
                    }
                    else {
                        svgW.append("image")
                        .attr("x", xScale(+d.GDP_per_Capita))
                        .attr("y", yScaleW(+d.Medals))
                        .attr("xlink:href", "img/ByName/" + d.Country + ".png")
                        .attr("width", 20);
                    }


                }
                else {
                    svgW.append("circle")
                    .attr("r", 2)
                    .attr("cx", xScale(+d.GDP_per_Capita))
                    .attr("cy", yScaleW(+d.Medals))
                    .style("fill","black");
                }
            })
        }
    </script>


</body>



</html>
